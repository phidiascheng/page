<html>
  <head>
    <meta charset="utf-8" />
    <script src="js/hanzi-writer.min.js"></script>
    <script src="js/jquery.min.js"></script>
  </head>
  <body>
    <div style="display: flex; justify-content: center; width: 100%; height: 600px; align-items: center;">
        <div style="width: 30%; text-align: center;">
            <label lang="zh-CN" style="width:100%; font-family: 楷体-简; font-size: 40px;" for="text-input">练习的汉字:</label>
            <br><br>
            <input style="border: solid; border-width: 1px; width:70%; font-family: 楷体-简; font-size: 100px;" id="text-input" type="text" placeholder="输入:">
            <br><br><br><br>
            <button style="width: 100px; height: 48px; font-family: 楷体-简; font-size: 30px;" onclick="show()" id="animate-button">演示</button>
    <br><br>
        </div>
        <div style="width: 40%; ">
            <div id="character-target-div" style="width: 500px; height: 500px; border: solid; border-width: 0.4px;"></div>
        </div>
    </div>
  </body>

  <script>

async function test() {
    let a = '我';
    const url = "assets/hanzi/"+a+".json";
    const response = await fetch(url)
    .then(res => res.text())
    .then(data => alert(data));
}

    var words = "";
    var writer;
    function getchar(){
        const word =document.getElementById('text-input').value;
        words = "";
        var re= RegExp("^[A-Za-z0-9]+$"); //英文和数字
        var re1=RegExp("^[\u4E00-\u9FA5A-Za-z0-9]+$");// 汉字、英文、数字
        for (let char of word){
            if (re.test(char) || !re1.test(char)){
                // 不是汉字 pass
            }
            else{
                words = words + char;
            }
        }
        if(words == ""){
            // 没有输入任何汉字
        }
        else{
            words = words[0]; //取第一个汉字        
        }
        demo(words);
        show();
    }    
    
    


async function demo(char){
        document.getElementById('character-target-div').innerHTML = "";
        writer = HanziWriter.create('character-target-div', char, {
            charDataLoader: function(char, onComplete) {
            $.getJSON("/gethanzi?char=" + char, 
            function(charData) {
                onComplete(charData);
            });
            },

            width: 500,
            height: 500,
            padding: 5,
            showOutline: true,
            strokeAnimationSpeed: 1.2,
        });
    }
    
function show(){
    writer.animateCharacter();
}

const inputElement = document.getElementById('text-input');
inputElement.addEventListener('input',(event) => {
    getchar();
//    demo(char);
});


</script>

</html>